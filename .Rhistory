term == "pred" & Response == "barrel" ~ "pred_bbarrel",
term == "pred" & Response == "strike" ~ "pred_bstrike",
TRUE ~ term))
View(model)
runApp()
zone_data <- read_csv("zone_data.csv") %>%
select(-...1)
View(zone_data)
View(zone_data)
models <- read_csv("models4.csv") %>%
mutate(Pitch = str_replace(Pitch, "FF", "fastball"),
Pitch = str_replace(Pitch, "SL", "slider"),
Pitch = str_replace(Pitch, "CU", "curveball"),
Pitch = str_replace(Pitch, "CH", "changeup")) %>%
mutate(Hand = ifelse(BHand == "R", "right", "left")) %>%
mutate(Response = case_when(Response == "STRIKE" ~ "strike",
Response == "Barrel" ~ "barrel",
Response == "whiff" ~ "whiff")) %>%
mutate(term = case_when(term == "pred" & Response == "whiff" ~ "pred_bwhiff",
term == "pred" & Response == "barrel" ~ "pred_bbarrel",
term == "pred" & Response == "strike" ~ "pred_bstrike",
TRUE ~ term))
View(models)
heat_map <- zone_data %>%
mutate(hand = ifelse(hand == "right", "R", "L")) %>%
filter(response == "strike",
hand == b_hand,
pitch == pitch_type) %>%
mutate(zone = get_zone(x, z)) %>%
mutate(z_pred = case_when(zone == "1" ~  test$zone1,
zone == "2" ~  test$zone2,
zone == "3" ~  test$zone3,
zone == "4" ~  test$zone4,
zone == "6" ~  test$zone6,
zone == "7" ~  test$zone7,
zone == "8" ~  test$zone8,
zone == "9" ~  test$zone9,
zone == "11" ~  test$zone11,
zone == "12" ~  test$zone12,
zone == "13" ~  test$zone13,
zone == "14" ~  test$zone14,
TRUE ~ 0))
heat_map <- zone_data %>%
mutate(hand = ifelse(hand == "right", "R", "L")) %>%
# filter(response == "strike",
#        hand == b_hand,
#        pitch == pitch_type) %>%
mutate(zone = get_zone(x, z)) %>%
mutate(z_pred = case_when(zone == "1" ~  test$zone1,
zone == "2" ~  test$zone2,
zone == "3" ~  test$zone3,
zone == "4" ~  test$zone4,
zone == "6" ~  test$zone6,
zone == "7" ~  test$zone7,
zone == "8" ~  test$zone8,
zone == "9" ~  test$zone9,
zone == "11" ~  test$zone11,
zone == "12" ~  test$zone12,
zone == "13" ~  test$zone13,
zone == "14" ~  test$zone14,
TRUE ~ 0))
# Zone Function (by Proportion)
get_zone <- function(x, z){
case_when(x > 0.33 & x <= 1 & z <= 1 & z > 0.33 ~ "1",
x <= 0.33 & x >= -0.33 & z <= 1 & z > 0.33 ~ "2",
x < -0.33 & x >= -1 & z <= 1 & z > 0.33 ~ "3",
x > 0.33 & x <= 1 & z <= 0.33 & z >= -0.33 ~ "4",
x <= 0.33 & x >= -0.33 & z <= 0.33 & z >= -0.33 ~ "5",
x < -0.33 & x >= -1 & z <= 0.33 & z >= -0.33 ~ "6",
x > 0.33 & x <= 1 & z < -0.33 & z >= -1 ~ "7",
x <= 0.33 & x >= -0.33 & z < -0.33 & z >= -1 ~ "8",
x < -0.33 & x >= -1 & z < -0.33 & z >= -1 ~ "9",
x > 0 & z >= 0 ~ "11",
x <= 0 & z > 0 ~ "12",
x >= 0 & z < 0 ~ "13",
x < 0 & z <= 0 ~ "14",
TRUE ~ "15")
}
heat_map <- zone_data %>%
mutate(hand = ifelse(hand == "right", "R", "L")) %>%
# filter(response == "strike",
#        hand == b_hand,
#        pitch == pitch_type) %>%
mutate(zone = get_zone(x, z)) %>%
mutate(z_pred = case_when(zone == "1" ~  test$zone1,
zone == "2" ~  test$zone2,
zone == "3" ~  test$zone3,
zone == "4" ~  test$zone4,
zone == "6" ~  test$zone6,
zone == "7" ~  test$zone7,
zone == "8" ~  test$zone8,
zone == "9" ~  test$zone9,
zone == "11" ~  test$zone11,
zone == "12" ~  test$zone12,
zone == "13" ~  test$zone13,
zone == "14" ~  test$zone14,
TRUE ~ 0))
View(zone_data)
library(tidyverse)
options(scipen = 999)
models <- read_csv("models4.csv") %>%
mutate(Pitch = str_replace(Pitch, "FF", "fastball"),
Pitch = str_replace(Pitch, "SL", "slider"),
Pitch = str_replace(Pitch, "CU", "curveball"),
Pitch = str_replace(Pitch, "CH", "changeup")) %>%
mutate(Hand = ifelse(BHand == "R", "right", "left")) %>%
mutate(Response = case_when(Response == "STRIKE" ~ "strike",
Response == "Barrel" ~ "barrel",
Response == "whiff" ~ "whiff")) %>%
mutate(term = case_when(term == "pred" & Response == "whiff" ~ "pred_bwhiff",
term == "pred" & Response == "barrel" ~ "pred_bbarrel",
term == "pred" & Response == "strike" ~ "pred_bstrike",
TRUE ~ term))
zones <- models %>%
select(zone1:zone9) %>%
table(models$term)
table(models$Pitch)
table(models$Hand)
models %>%
filter(Hand == "right",
Response == "whiff") %>%
ggplot(aes(x = Pitch, y = term, fill = abs(log10(p.value)))) +
geom_tile()
models %>%
filter(Hand == "right",
Response == "whiff") %>%
filter(term == "pred_bwhiff") %>%
pull(p.value) %>%
log10()
View
models %>%
filter(Hand == "right") %>%
filter(term != "pred_bbarrel", term != "(Intercept)") %>%
ggplot(aes(x = Pitch, y = term, fill = abs(log10(p.value)))) +
geom_tile() +
facet_wrap(vars(Response))
test_data <- models %>%
filter(Hand == "right",
Pitch == "slider",
Response == "whiff")
zone_data <- data.frame(x = seq(-2, 2, .1),
z = seq(-2.5, 1.5, .1),
response = rep(c("whiff", "strike", "barrel"), length.out = 41),
hand = rep(c("right", "left"), length.out = 41),
pitch = rep(c("fastball", "slider", "curveball", "changeup"), length.out = 41)) %>%
expand(x, z, response, hand, pitch) %>%
mutate(pred = NA)
for(response in c("whiff", "strike", "barrel")) {
for(hand in c("right", "left")) {
for(pitch in c("fastball", "slider", "curveball", "changeup")) {
test_data <- filter(models, Hand == hand, Pitch == pitch, Response == response)
test_x <- pull(filter(test_data, term == "dist_x"), estimate)
test_x2 <- pull(filter(test_data, term == "I(dist_x^2)"), estimate)
test_z <- pull(filter(test_data, term == "dist_z"), estimate)
test_z2 <- pull(filter(test_data, term == "I(dist_z^2)"), estimate)
test_prop <- pull(filter(test_data, term == "dist_prop"), estimate)
if(is.na(test_x)) {test_x <- 0}
if(is.na(test_z)) {test_z <- 0}
if(is.na(test_x2)) {test_x2 <- 0}
if(is.na(test_z2)) {test_z2 <- 0}
if(!is.null(is.na(test_prop))) {test_prop <- 0}
zone_data[zone_data$response == response & zone_data$hand == hand & zone_data$pitch == pitch,] <- zone_data[zone_data$response == response & zone_data$hand == hand & zone_data$pitch == pitch,] %>%
mutate(pred = x * test_x + z * test_z +
x^2 * test_x2 + z^2 * test_z2 +
sqrt(x^2 + z^2) * test_prop)
}
}
}
for(response in c("whiff", "strike", "barrel")) {
for(hand in c("right", "left")) {
for(pitch in c("fastball", "slider", "curveball", "changeup")) {
test_data <- filter(models, Hand == hand, Pitch == pitch, Response == response)
test_x <- pull(filter(test_data, term == "dist_x"), estimate)
test_x2 <- pull(filter(test_data, term == "I(dist_x^2)"), estimate)
test_z <- pull(filter(test_data, term == "dist_z"), estimate)
test_z2 <- pull(filter(test_data, term == "I(dist_z^2)"), estimate)
test_prop <- pull(filter(test_data, term == "dist_prop"), estimate)
if(is.na(test_x)) {test_x <- 0}
if(is.na(test_z)) {test_z <- 0}
if(is.na(test_x2)) {test_x2 <- 0}
if(is.na(test_z2)) {test_z2 <- 0}
if(!is.null(is.na(test_prop))) {test_prop <- 0}
if(!is.null(is.na(test_x))) {test_x <- 0}
zone_data[zone_data$response == response & zone_data$hand == hand & zone_data$pitch == pitch,] <- zone_data[zone_data$response == response & zone_data$hand == hand & zone_data$pitch == pitch,] %>%
mutate(pred = x * test_x + z * test_z +
x^2 * test_x2 + z^2 * test_z2 +
sqrt(x^2 + z^2) * test_prop)
}
}
}
table(model$term)
model %>%
mutate(log_pval = -log10(p.value)) %>%
ggplot(aes(x = Pitch,
y = term,
fill = log_pval)) +
scale_fill_gradient2(low = "khaki1",
high = "green",
na.value = "darkgreen") +
geom_tile(color = "darkgray") +
facet_grid(BHand ~ Response) +
theme_dark()
for(response in c("whiff", "strike", "barrel")) {
for(hand in c("right", "left")) {
for(pitch in c("fastball", "slider", "curveball", "changeup")) {
test_data <- filter(models, Hand == hand, Pitch == pitch, Response == response)
test_x <- pull(filter(test_data, term == "dist_x"), estimate)
test_x2 <- pull(filter(test_data, term == "I(dist_x^2)"), estimate)
test_z <- pull(filter(test_data, term == "dist_z"), estimate)
test_z2 <- pull(filter(test_data, term == "I(dist_z^2)"), estimate)
test_prop <- pull(filter(test_data, term == "dist_prop"), estimate)
if(is.na(test_x)) {test_x <- 0}
if(is.na(test_z)) {test_z <- 0}
if(is.na(test_x2)) {test_x2 <- 0}
if(is.na(test_z2)) {test_z2 <- 0}
if(!is.null(is.na(test_prop))) {test_prop <- 0}
if(!is.null(is.na(test_x))) {test_x <- 0}
if(!is.null(is.na(test_z))) {test_z <- 0}
zone_data[zone_data$response == response & zone_data$hand == hand & zone_data$pitch == pitch,] <- zone_data[zone_data$response == response & zone_data$hand == hand & zone_data$pitch == pitch,] %>%
mutate(pred = x * test_x + z * test_z +
x^2 * test_x2 + z^2 * test_z2 +
sqrt(x^2 + z^2) * test_prop)
}
}
}
for(response in c("whiff", "strike", "barrel")) {
for(hand in c("right", "left")) {
for(pitch in c("fastball", "slider", "curveball", "changeup")) {
test_data <- filter(models, Hand == hand, Pitch == pitch, Response == response)
test_x <- pull(filter(test_data, term == "dist_x"), estimate)
test_x2 <- pull(filter(test_data, term == "I(dist_x^2)"), estimate)
test_z <- pull(filter(test_data, term == "dist_z"), estimate)
test_z2 <- pull(filter(test_data, term == "I(dist_z^2)"), estimate)
test_prop <- pull(filter(test_data, term == "dist_prop"), estimate)
if(is.na(test_x)) {test_x <- 0}
if(is.na(test_z)) {test_z <- 0}
if(is.na(test_x2)) {test_x2 <- 0}
if(is.na(test_z2)) {test_z2 <- 0}
if(!is.null(is.na(test_prop))) {test_prop <- 0}
if(!is.null(is.na(test_x))) {test_x <- 0}
if(!is.null(is.na(test_z))) {test_z <- 0}
if(!is.null(is.na(test_x2))) {test_x2 <- 0}
if(!is.null(is.na(test_z2))) {test_z2 <- 0}
zone_data[zone_data$response == response & zone_data$hand == hand & zone_data$pitch == pitch,] <- zone_data[zone_data$response == response & zone_data$hand == hand & zone_data$pitch == pitch,] %>%
mutate(pred = x * test_x + z * test_z +
x^2 * test_x2 + z^2 * test_z2 +
sqrt(x^2 + z^2) * test_prop)
}
}
}
for(response in c("whiff", "strike", "barrel")) {
for(hand in c("right", "left")) {
for(pitch in c("fastball", "slider", "curveball", "changeup")) {
test_data <- filter(models, Hand == hand, Pitch == pitch, Response == response)
test_x <- pull(filter(test_data, term == "dist_x"), estimate)
test_x2 <- pull(filter(test_data, term == "I(dist_x^2)"), estimate)
test_z <- pull(filter(test_data, term == "dist_z"), estimate)
test_z2 <- pull(filter(test_data, term == "I(dist_z^2)"), estimate)
test_prop <- pull(filter(test_data, term == "dist_prop"), estimate)
if(is.na(test_x)) {test_x <- 0}
if(is.na(test_z)) {test_z <- 0}
if(is.na(test_x2)) {test_x2 <- 0}
if(is.na(test_z2)) {test_z2 <- 0}
if(!is.null(is.na(test_prop))) {test_prop <- 0}
if(!is.null(is.na(test_x))) {test_x <- 0}
if(!is.null(is.na(test_z))) {test_z <- 0}
if(!is.null(is.na(test_x2))) {test_x2 <- 0}
if(!is.null(is.na(test_z2))) {test_z2 <- 0}
zone_data[zone_data$response == response & zone_data$hand == hand & zone_data$pitch == pitch,] <- zone_data[zone_data$response == response & zone_data$hand == hand & zone_data$pitch == pitch,] %>%
mutate(pred = x * test_x + z * test_z +
x^2 * test_x2 + z^2 * test_z2 +
sqrt(x^2 + z^2) * test_prop)
}
}
}
for(response in c("whiff", "strike", "barrel")) {
for(hand in c("right", "left")) {
for(pitch in c("fastball", "slider", "curveball", "changeup")) {
test_data <- filter(models, Hand == hand, Pitch == pitch, Response == response)
test_x <- pull(filter(test_data, term == "dist_x"), estimate)
test_x2 <- pull(filter(test_data, term == "I(dist_x^2)"), estimate)
test_z <- pull(filter(test_data, term == "dist_z"), estimate)
test_z2 <- pull(filter(test_data, term == "I(dist_z^2)"), estimate)
test_prop <- pull(filter(test_data, term == "dist_prop"), estimate)
if(is.na(test_x)) {test_x <- 0}
if(is.na(test_z)) {test_z <- 0}
if(is.na(test_x2)) {test_x2 <- 0}
if(is.na(test_z2)) {test_z2 <- 0}
if(!is.null(is.na(test_prop))) {test_prop <- 0}
if(!is.null(is.na(test_x))) {test_x <- 0}
if(!is.null(is.na(test_z))) {test_z <- 0}
if(!is.null(is.na(test_x2))) {test_x2 <- 0}
if(!is.null(is.na(test_z2))) {test_z2 <- 0}
zone_data[zone_data$response == response & zone_data$hand == hand & zone_data$pitch == pitch,] <- zone_data[zone_data$response == response & zone_data$hand == hand & zone_data$pitch == pitch,] %>%
mutate(pred = x * test_x + z * test_z +
x^2 * test_x2 + z^2 * test_z2 +
sqrt(x^2 + z^2) * test_prop)
}
}
}
View(models)
for(response in c("whiff", "strike", "barrel")) {
for(hand in c("right", "left")) {
for(pitch in c("fastball", "slider", "curveball", "changeup")) {
test_data <- filter(models, Hand == hand, Pitch == pitch, Response == response)
test_x <- pull(filter(test_data, term == "dist_x"), estimate)
test_x2 <- pull(filter(test_data, term == "I(dist_x^2)"), estimate)
test_z <- pull(filter(test_data, term == "dist_z"), estimate)
test_z2 <- pull(filter(test_data, term == "I(dist_z^2)"), estimate)
test_prop <- pull(filter(test_data, term == "dist_prop"), estimate)
# if(is.na(test_x)) {test_x <- 0}
# if(is.na(test_z)) {test_z <- 0}
# if(is.na(test_x2)) {test_x2 <- 0}
# if(is.na(test_z2)) {test_z2 <- 0}
if(!is.null(is.na(test_prop))) {test_prop <- 0}
if(!is.null(is.na(test_x))) {test_x <- 0}
if(!is.null(is.na(test_z))) {test_z <- 0}
if(!is.null(is.na(test_x2))) {test_x2 <- 0}
if(!is.null(is.na(test_z2))) {test_z2 <- 0}
zone_data[zone_data$response == response & zone_data$hand == hand & zone_data$pitch == pitch,] <- zone_data[zone_data$response == response & zone_data$hand == hand & zone_data$pitch == pitch,] %>%
mutate(pred = x * test_x + z * test_z +
x^2 * test_x2 + z^2 * test_z2 +
sqrt(x^2 + z^2) * test_prop)
}
}
}
for(response in c("whiff", "strike", "barrel")) {
for(hand in c("right", "left")) {
for(pitch in c("fastball", "slider", "curveball", "changeup")) {
test_data <- filter(models, Hand == hand, Pitch == pitch, Response == response)
test_x <- pull(filter(test_data, term == "dist_x"), estimate)
test_x2 <- pull(filter(test_data, term == "I(dist_x^2)"), estimate)
test_z <- pull(filter(test_data, term == "dist_z"), estimate)
test_z2 <- pull(filter(test_data, term == "I(dist_z^2)"), estimate)
test_prop <- pull(filter(test_data, term == "dist_prop"), estimate)
# if(is.na(test_x)) {test_x <- 0}
# if(is.na(test_z)) {test_z <- 0}
# if(is.na(test_x2)) {test_x2 <- 0}
# if(is.na(test_z2)) {test_z2 <- 0}
if(!is.null(is.na(test_prop))) {test_prop <- 0}
if(!is.null(is.na(test_x))) {test_x <- 0}
if(!is.null(is.na(test_z))) {test_z <- 0}
if(!is.null(is.na(test_x2))) {test_x2 <- 0}
if(!is.null(is.na(test_z2))) {test_z2 <- 0}
zone_data[zone_data$response == response & zone_data$hand == hand & zone_data$pitch == pitch,] <- zone_data[zone_data$response == response & zone_data$hand == hand & zone_data$pitch == pitch,] %>%
mutate(pred = x * test_x + z * test_z +
x^2 * test_x2 + z^2 * test_z2 +
sqrt(x^2 + z^2) * test_prop)
}
}
}
View(zone_data)
View(zone_data)
for(response in c("whiff", "strike", "barrel")) {
for(hand in c("right", "left")) {
for(pitch in c("fastball", "slider", "curveball", "changeup")) {
test_data <- filter(models, Hand == hand, Pitch == pitch, Response == response)
test_x <- pull(filter(test_data, term == "dist_x"), estimate)
test_x2 <- pull(filter(test_data, term == "I(dist_x^2)"), estimate)
test_z <- pull(filter(test_data, term == "dist_z"), estimate)
test_z2 <- pull(filter(test_data, term == "I(dist_z^2)"), estimate)
test_prop <- pull(filter(test_data, term == "dist_prop"), estimate)
# if(is.na(test_x)) {test_x <- 0}
# if(is.na(test_z)) {test_z <- 0}
# if(is.na(test_x2)) {test_x2 <- 0}
# if(is.na(test_z2)) {test_z2 <- 0}
if(!is.null(is.na(test_prop))) {test_prop <- 0}
if(!is.null(is.na(test_x))) {test_x <- 0}
if(!is.null(is.na(test_z))) {test_z <- 0}
if(!is.null(is.na(test_x2))) {test_x2 <- 0}
if(!is.null(is.na(test_z2))) {test_z2 <- 0}
zone_data[zone_data$response == response & zone_data$hand == hand & zone_data$pitch == pitch,] <- zone_data[zone_data$response == response & zone_data$hand == hand & zone_data$pitch == pitch,] %>%
mutate(pred = x * test_x + z * test_z +
x^2 * test_x2 + z^2 * test_z2 +
sqrt(x^2 + z^2) * test_prop)
}
}
}
for(response in c("whiff", "strike", "barrel")) {
for(hand in c("right", "left")) {
for(pitch in c("fastball", "slider", "curveball", "changeup")) {
test_data <- filter(models, Hand == hand, Pitch == pitch, Response == response)
test_x <- pull(filter(test_data, term == "dist_x"), estimate)
test_x2 <- pull(filter(test_data, term == "I(dist_x^2)"), estimate)
test_z <- pull(filter(test_data, term == "dist_z"), estimate)
test_z2 <- pull(filter(test_data, term == "I(dist_z^2)"), estimate)
test_prop <- pull(filter(test_data, term == "dist_prop"), estimate)
# if(is.na(test_x)) {test_x <- 0}
# if(is.na(test_z)) {test_z <- 0}
# if(is.na(test_x2)) {test_x2 <- 0}
# if(is.na(test_z2)) {test_z2 <- 0}
if(!is.null(is.na(test_prop))) {test_prop <- 0}
if(!is.null(is.na(test_x))) {test_x <- 0}
if(!is.null(is.na(test_z))) {test_z <- 0}
if(!is.null(is.na(test_x2))) {test_x2 <- 0}
if(!is.null(is.na(test_z2))) {test_z2 <- 0}
zone_data[zone_data$response == response & zone_data$hand == hand & zone_data$pitch == pitch,] <- zone_data[zone_data$response == response & zone_data$hand == hand & zone_data$pitch == pitch,] %>%
mutate(pred = x * test_x + z * test_z +
x^2 * test_x2 + z^2 * test_z2 +
sqrt(x^2 + z^2) * test_prop)
}
}
}
View(zone_data)
table(zone_data$response)
table(zone_data$hand)
table(zone_data$pitch)
hist(zone_data$pred)
response <- "whiff"
hand <- "right"
pitch <- "fastball"
test_data <- filter(models, Hand == hand, Pitch == pitch, Response == response)
View(test_data)
test_x <- pull(filter(test_data, term == "dist_x"), estimate)
View(test_data)
test_x2 <- pull(filter(test_data, term == "I(dist_x^2)"), estimate)
test_z <- pull(filter(test_data, term == "dist_z"), estimate)
test_z2 <- pull(filter(test_data, term == "I(dist_z^2)"), estimate)
test_prop <- pull(filter(test_data, term == "dist_prop"), estimate)
if(is.na(test_x)) {test_x <- 0}
if(is.na(test_x) | is_empty(test_x)) {test_x <- 0}
is_empty(test_x)
if(is_empty(test_x)) {test_x <- 0}
for(response in c("whiff", "strike", "barrel")) {
for(hand in c("right", "left")) {
for(pitch in c("fastball", "slider", "curveball", "changeup")) {
test_data <- filter(models, Hand == hand, Pitch == pitch, Response == response)
test_x <- pull(filter(test_data, term == "dist_x"), estimate)
test_x2 <- pull(filter(test_data, term == "I(dist_x^2)"), estimate)
test_z <- pull(filter(test_data, term == "dist_z"), estimate)
test_z2 <- pull(filter(test_data, term == "I(dist_z^2)"), estimate)
test_prop <- pull(filter(test_data, term == "dist_prop"), estimate)
if(is_empty(test_x)) {test_x <- 0}
if(is.na(test_z)) {test_z <- 0}
if(is.na(test_x2)) {test_x2 <- 0}
if(is.na(test_z2)) {test_z2 <- 0}
if(!is.null(is.na(test_prop))) {test_prop <- 0}
zone_data[zone_data$response == response & zone_data$hand == hand & zone_data$pitch == pitch,] <- zone_data[zone_data$response == response & zone_data$hand == hand & zone_data$pitch == pitch,] %>%
mutate(pred = x * test_x + z * test_z +
x^2 * test_x2 + z^2 * test_z2 +
sqrt(x^2 + z^2) * test_prop)
}
}
}
for(response in c("whiff", "strike", "barrel")) {
for(hand in c("right", "left")) {
for(pitch in c("fastball", "slider", "curveball", "changeup")) {
test_data <- filter(models, Hand == hand, Pitch == pitch, Response == response)
test_x <- pull(filter(test_data, term == "dist_x"), estimate)
test_x2 <- pull(filter(test_data, term == "I(dist_x^2)"), estimate)
test_z <- pull(filter(test_data, term == "dist_z"), estimate)
test_z2 <- pull(filter(test_data, term == "I(dist_z^2)"), estimate)
test_prop <- pull(filter(test_data, term == "dist_prop"), estimate)
if(is_empty(test_x)) {test_x <- 0}
if(is_empty(test_z)) {test_z <- 0}
if(is.na(test_x2)) {test_x2 <- 0}
if(is.na(test_z2)) {test_z2 <- 0}
if(!is.null(is.na(test_prop))) {test_prop <- 0}
zone_data[zone_data$response == response & zone_data$hand == hand & zone_data$pitch == pitch,] <- zone_data[zone_data$response == response & zone_data$hand == hand & zone_data$pitch == pitch,] %>%
mutate(pred = x * test_x + z * test_z +
x^2 * test_x2 + z^2 * test_z2 +
sqrt(x^2 + z^2) * test_prop)
}
}
}
View(zone_data)
rm(zone_data)
for(pitch in c("fastball", "slider", "curveball", "changeup")) {
test_data <- filter(models, Hand == hand, Pitch == pitch, Response == response)
test_x <- pull(filter(test_data, term == "dist_x"), estimate)
test_x2 <- pull(filter(test_data, term == "I(dist_x^2)"), estimate)
test_z <- pull(filter(test_data, term == "dist_z"), estimate)
test_z2 <- pull(filter(test_data, term == "I(dist_z^2)"), estimate)
test_prop <- pull(filter(test_data, term == "dist_prop"), estimate)
if(is_empty(test_x)) {test_x <- 0}
if(is_empty(test_z)) {test_z <- 0}
if(is.na(test_x2)) {test_x2 <- 0}
if(is.na(test_z2)) {test_z2 <- 0}
if(!is.null(is.na(test_prop))) {test_prop <- 0}
zone_data[zone_data$response == response & zone_data$hand == hand & zone_data$pitch == pitch,] <- zone_data[zone_data$response == response & zone_data$hand == hand & zone_data$pitch == pitch,] %>%
mutate(pred = x * test_x + z * test_z +
x^2 * test_x2 + z^2 * test_z2 +
sqrt(x^2 + z^2) * test_prop)
}
for(response in c("whiff", "strike", "barrel")) {
for(hand in c("right", "left")) {
for(pitch in c("fastball", "slider", "curveball", "changeup")) {
test_data <- filter(models, Hand == hand, Pitch == pitch, Response == response)
test_x <- pull(filter(test_data, term == "dist_x"), estimate)
test_x2 <- pull(filter(test_data, term == "I(dist_x^2)"), estimate)
test_z <- pull(filter(test_data, term == "dist_z"), estimate)
test_z2 <- pull(filter(test_data, term == "I(dist_z^2)"), estimate)
test_prop <- pull(filter(test_data, term == "dist_prop"), estimate)
if(is_empty(test_x)) {test_x <- 0}
if(is_empty(test_z)) {test_z <- 0}
if(is.na(test_x2)) {test_x2 <- 0}
if(is.na(test_z2)) {test_z2 <- 0}
if(!is.null(is.na(test_prop))) {test_prop <- 0}
zone_data[zone_data$response == response & zone_data$hand == hand & zone_data$pitch == pitch,] <- zone_data[zone_data$response == response & zone_data$hand == hand & zone_data$pitch == pitch,] %>%
mutate(pred = x * test_x + z * test_z +
x^2 * test_x2 + z^2 * test_z2 +
sqrt(x^2 + z^2) * test_prop)
}
}
}
zone_data <- data.frame(x = seq(-2, 2, .1),
z = seq(-2.5, 1.5, .1),
response = rep(c("whiff", "strike", "barrel"), length.out = 41),
hand = rep(c("right", "left"), length.out = 41),
pitch = rep(c("fastball", "slider", "curveball", "changeup"), length.out = 41)) %>%
expand(x, z, response, hand, pitch) %>%
mutate(pred = NA)
