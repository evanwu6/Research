geom_histogram(binwidth = 0.15, color = "white")
pitchers %>%
ggplot(aes(x = log(run_exp_added))) +
geom_histogram(binwidth = 0.15, color = "white")
pitchers %>%
filter(run_exp_added > 0) %>%
ggplot(aes(x = log(run_exp_added))) +
geom_histogram(binwidth = 0.15, color = "white")
pitchers %>%
filter(run_exp_added > 0) %>%
ggplot(aes(x = log(1+run_exp_added))) +
geom_histogram(binwidth = 0.15, color = "white")
pitchers %>%
filter(run_exp_added > 0) %>%
ggplot(aes(x = run_exp_added)) +
geom_histogram(binwidth = 0.15, color = "white")
pitchers %>%
ggplot(aes(x = run_exp_added)) +
geom_histogram(binwidth = 0.15, color = "white")
# Model Data (Pitch = Slider, Pitching Hand = Right)
rhp_ff_data <- arsenal %>%
filter(pitch_type == "FF",
pitch_hand == "R") %>%
mutate(ovr_break = sqrt(pitcher_break_x^2 + pitcher_break_z^2))
# Simple Linear Regression
lm_ff <- lm(xwOBA ~
pitch_speed + spin_rate + pitcher_break_x + pitcher_break_z +
pitch_usage + ovr_break,
data = rhp_ff_data)
summary(lm_ff)
# Stepwise Selection
lm_ff %>% ols_step_both_p(prem = 0.15, pent = 0.15)
# Stepwise Selection
lm_ff %>% ols_step_both_p(prem = 0.15, pent = 0.15)
# New Model
lm1_ff <- lm(xwOBA ~
ovr_break + pitch_usage + pitch_speed,
data = rhp_ff_data)
lm1_ff %>%
summary()
# Stepwise Selection
lm_ff %>% ols_step_both_p(prem = 0.15, pent = 0.15)
# New Model
lm1_ff <- lm(xwOBA ~
spin_rate + pitcher_break_x + pitcher_break_z + pitch_speed,
data = rhp_ff_data)
lm1_ff %>%
summary()
# New Model
lm1_ff <- lm(xwOBA ~
spin_rate + pitcher_break_x*pitcher_break_z + pitch_speed,
data = rhp_ff_data)
lm1_ff %>%
summary()
# New Model
lm1_ff <- lm(xwOBA ~
spin_rate + pitcher_break_x + ovr_break + pitcher_break_z + pitch_speed,
data = rhp_ff_data)
lm1_ff %>%
summary()
# New Model
lm1_ff <- lm(xwOBA ~
spin_rate + pitcher_break_x*pitcher_break_z + pitch_speed,
data = rhp_ff_data)
lm1_ff %>%
summary()
pitchers %>%
filter(pitch_type == "FF") %>%
with(cor(spin_rate, pitch_speed))
arsenal %>%
filter(pitch_type == "FF") %>%
with(cor(spin_rate, pitch_speed))
arsenal %>%
filter(pitch_type == "FF") %>%
with(cor(release_spin_rate, pitch_speed))
pitchers %>%
filter(pitch_type == "FF") %>%
with(cor(release_spin_rate, pitch_speed))
pitchers %>%
filter(pitch_type == "FF",
!is.na(release_spin_rate),
!is.na(pitch_speed)) %>%
with(cor(release_spin_rate, pitch_speed))
pitcher %>%
mutate(pitch_dist = sqrt(plate_x^2 + (2.5 - plate_z)^2),
pitch_dist_sq = pitch_dist^2)
pitchers %>%
mutate(pitch_dist = sqrt(plate_x^2 + (2.5 - plate_z)^2),
pitch_dist_sq = pitch_dist^2)
hi <- pitchers %>%
mutate(pitch_dist = sqrt(plate_x^2 + (2.5 - plate_z)^2),
pitch_dist_sq = pitch_dist^2)
View(hi)
lm(run_exp_added ~ pitch_dist + pitch_dist_sq +
spin_rate + pitcher_break_x*pitcher_break_z + pitch_speed,
data = hi)
lm(run_exp_added ~ pitch_dist + pitch_dist_sq +
release_spin_rate + pitcher_break_x*pitcher_break_z + pitch_speed,
data = hi)
lm(run_exp_added ~ pitch_dist + pitch_dist_sq +
release_spin_rate + pfx_x*pfx_z + pitch_speed,
data = hi)
lm(run_exp_added ~ pitch_dist + pitch_dist_sq +
release_spin_rate + pfx_x*pfx_z + pitch_speed,
data = hi) %>%
summary()
lm(run_exp_added ~ pitch_dist_sq +
release_spin_rate + pfx_x*pfx_z + pitch_speed,
data = hi) %>%
summary()
lm(run_exp_added ~ pitch_dist +
release_spin_rate + pfx_x*pfx_z + pitch_speed,
data = hi) %>%
summary()
lm(run_exp_added ~ pitch_dist_sq + pitch_dist +
release_spin_rate + pfx_x*pfx_z + pitch_speed,
data = hi) %>%
summary()
lm(run_exp_added ~ pitch_dist_sq + pitch_dist +
release_spin_rate + pfx_x*pfx_z ,
data = hi) %>%
summary()
lm(run_exp_added ~ pitch_dist +
release_spin_rate + pfx_x*pfx_z ,
data = hi) %>%
summary()
lm(run_exp_added ~ pitch_dist +
pfx_x*pfx_z ,
data = hi) %>%
summary()
lm(run_exp_added ~ pitch_dist +
pfx_z ,
data = hi) %>%
summary()
hi <- pitchers %>%
filter(pitch_type == "FF") %>%
mutate(pitch_dist = sqrt(plate_x^2 + (2.5 - plate_z)^2),
pitch_dist_sq = pitch_dist^2)
lm(run_exp_added ~ pitch_dist_sq + pitch_dist_sq +
release_spin_rate + pfx_x*pfx_z + pitch_speed,
data = hi) %>%
summary()
lm(run_exp_added ~ pitch_dist_sq + pitch_dist_sq +
release_spin_rate + pfx_x*pfx_z,
data = hi) %>%
summary()
lm(run_exp_added ~ pitch_dist_sq + pitch_dist_sq +
release_spin_rate,
data = hi) %>%
summary()
lm(run_exp_added ~ pitch_dist_sq + pitch_dist +
release_spin_rate,
data = hi) %>%
summary()
table(pitchers$pitch_name)
seasonal <- read_csv("CSVs/season_stats.csv")
pitchers <- read_csv("CSVs/pitcher_comps.csv")
arsenal <- read_csv("CSVs/arsenal.csv")
library(tidyverse)
library(tidyverse)
library(readxl)
library(ggforce)
library(knitr)
library(forcats)
library(olsrr)
library(ranger)
library(ranger)
library(Metrics)
set.seed(3630)
setwd("~/Downloads/Fall 2023/SABR Research/Research")
seasonal <- read_csv("CSVs/season_stats.csv")
seasonal <- read_csv("CSVs/season_stats.csv")
pitchers <- read_csv("CSVs/pitcher_comps.csv")
seasonal <- read_csv("CSVs/season_stats.csv")
pitchers <- read_csv("CSVs/pitcher_comps.csv")
arsenal <- read_csv("CSVs/arsenal.csv")
View(pitchers)
pitchers2 <- pitchers %>%
mutate(
loc_x = abs(plate_x),
loc_y = abs(plate_z - (sz_top + sz_bot) / 2))
View(pitchers2)
pitchers2 <- pitchers %>%
mutate(
loc_x = abs(plate_x),
loc_y = abs(plate_z - (sz_top + sz_bot) / 2),
dist = sqrt(loc_x^2 + loc_y^2))
View(pitchers2)
pitchers2 <- pitchers2 %>%
mutate(speed_change = pitch_speed - mean(pitch_speed),
.by = c(pitch_type, game_date, player_id) )
View(pitchers2)
View(pitchers2)
# Creating break change variable
pitchers2 <- pitchers2 %>%
mutate(pfx_total = sqrt(pfx_x^2 + pfx_z^2)) %>%
mutate(break_change = pfx_total - mean(pfx_total),
.by = c(pitch_type, game_date, player_id) )
pitchers2 %>%
ggplot(aes(x = break_change)) +
geom_histogram()
pitchers2 %>%
ggplot(aes(x = break_change)) +
geom_histogram(color = "white", binwidth = 0.1)
pitchers2 %>%
ggplot(aes(x = break_change*12)) +
geom_histogram(color = "white", binwidth = 1)
pitchers2 %>%
ggplot(aes(x = break_change*12)) +
geom_histogram(color = "white", binwidth = 0.5)
# Delta Speed
pitchers2 %>%
ggplot(aes(x = speed_change)) +
geom_histogram(color = "white", binwidth = 0.1)
# Delta Speed
pitchers2 %>%
ggplot(aes(x = speed_change)) +
geom_histogram(color = "white", binwidth = 0.5)
# Delta Speed
pitchers2 %>%
ggplot(aes(x = speed_change)) +
geom_histogram(color = "white", binwidth = 0.1)
# Delta Speed
pitchers2 %>%
ggplot(aes(x = speed_change)) +
geom_histogram(color = "white", binwidth = 0.25)
?facet_grid
# Delta Speed
pitchers2 %>%
ggplot(aes(x = speed_change)) +
geom_histogram(color = "white", binwidth = 0.25) +
facet_grid(~ pitch_name, cols = 1)
# Delta Speed
pitchers2 %>%
ggplot(aes(x = speed_change)) +
geom_histogram(color = "white", binwidth = 0.25) +
facet_grid(~ pitch_name)
# Delta Speed
pitchers2 %>%
filter(!(pitch_name %in% c("Pitch Out", "NA")) ) %>%
ggplot(aes(x = speed_change)) +
geom_histogram(color = "white", binwidth = 0.25) +
facet_grid(~ pitch_name)
# Delta Speed
pitchers2 %>%
filter(pitch_type != "Pitch Out",
!is.na(pitch_type)) %>%
ggplot(aes(x = speed_change)) +
geom_histogram(color = "white", binwidth = 0.25) +
facet_grid(~ pitch_name)
# Delta Speed
pitchers2 %>%
filter(pitch_type != "Pitch Out",
!is.na(pitch_type)) %>%
ggplot(aes(x = speed_change)) +
geom_histogram(color = "white", binwidth = 0.25) +
facet_wrap(~ pitch_name)
# Delta Speed
pitchers2 %>%
filter(pitch_type != "Pitch Out",
!is.na(pitch_type)) %>%
ggplot(aes(x = speed_change, fill = pitch_name)) +
geom_histogram(color = "white", binwidth = 0.25)
# Delta Speed
pitchers2 %>%
filter(pitch_type != "Pitch Out",
!is.na(pitch_type)) %>%
ggplot(aes(x = speed_change, fill = pitch_name), alpha = 0.5) +
geom_histogram(color = "white", binwidth = 0.25)
# Delta Speed
pitchers2 %>%
filter(pitch_type != "Pitch Out",
!is.na(pitch_type)) %>%
ggplot(aes(x = speed_change, fill = pitch_name), alpha = 0.5) +
geom_histogram(color = "white", binwidth = 0.25) +
scale_y_continuous(formatter = "percent")
# Delta Speed Percentage Scale
pitchers2 %>%
filter(pitch_type != "Pitch Out",
!is.na(pitch_type)) %>%
ggplot(aes(x = speed_change, fill = pitch_name), alpha = 0.5) +
geom_histogram(aes(y = ..density..), color = "white", binwidth = 0.25)
# Delta Speed Percentage Scale
pitchers2 %>%
filter(pitch_type != "Pitch Out",
!is.na(pitch_type)) %>%
ggplot(aes(x = speed_change, fill = pitch_name), alpha = 0.5) +
geom_histogram(aes(y = ..density..), color = "white", binwidth = 0.5)
# Distance from Center
pitchers2 %>%
ggplot(aes(x = dist*12)) +
geom_histogram(color = "white", binwidth = 0.5)
# Distance from Center
pitchers2 %>%
ggplot(aes(x = dist*12)) +
geom_histogram(color = "white", binwidth = 1)
# Distance from Center
pitchers2 %>%
ggplot(aes(x = dist)) +
geom_histogram(color = "white", binwidth = 0.25)
# Distance from Center
pitchers2 %>%
ggplot(aes(x = dist)) +
geom_histogram(color = "white", binwidth = 0.1)
# Distance vs. RE
pitchers2 %>%
ggplot(aes(x = dist, y = run_exp_added)) +
geom_point()
# Distance vs. RE
pitchers2 %>%
ggplot(aes(x = dist, y = run_exp_added)) +
geom_point() +
facet_wrap(~pitch_type)
# Distance vs. RE
pitchers2 %>%
ggplot(aes(x = dist, y = run_exp_added)) +
geom_point(alpha = 0.25) +
geom_smooth(se = FALSE)
# Distance vs. RE
pitchers2 %>%
ggplot(aes(x = dist, y = run_exp_added)) +
geom_point(alpha = 0.25) +
geom_smooth(se = FALSE) +
facet_wrap(~pitch_type)
# Creating distance from center variable
pitchers2 <- pitchers %>%
filter(pitch_type != "Pitch Out",
!is.na(pitch_type)) %>%
mutate(
loc_x = abs(plate_x),
loc_y = abs(plate_z - (sz_top + sz_bot) / 2),
dist = sqrt(loc_x^2 + loc_y^2))
# Creating speed change variable
pitchers2 <- pitchers2 %>%
mutate(speed_change = pitch_speed - mean(pitch_speed),
.by = c(pitch_type, game_date, player_id) )
# Creating break change variable
pitchers2 <- pitchers2 %>%
mutate(pfx_total = sqrt(pfx_x^2 + pfx_z^2)) %>%
mutate(break_change = pfx_total - mean(pfx_total),
.by = c(pitch_type, game_date, player_id) )
# Distance vs. RE
pitchers2 %>%
ggplot(aes(x = dist, y = run_exp_added)) +
geom_point(alpha = 0.25) +
geom_smooth(se = FALSE) +
facet_wrap(~pitch_type)
# Delta Break vs. RE
pitchers2 %>%
ggplot(aes(x = break_change, y = run_exp_added)) +
geom_point(alpha = 0.25) +
geom_smooth(se = FALSE) +
facet_wrap(~pitch_type)
# Delta Speed vs. RE
pitchers2 %>%
ggplot(aes(x = speed_change, y = run_exp_added)) +
geom_point(alpha = 0.25) +
geom_smooth(se = FALSE) +
facet_wrap(~pitch_type)
# Delta Speed
pitchers2 %>%
ggplot(aes(x = speed_change), alpha = 0.5) +
geom_histogram(color = "white", binwidth = 0.25)
if()
?if
?if]]]
?if
}
?if()
17/2/12
1.45/12
# Strike / Ball
pitchers2 <- pitchers %>%
mutate(zone = ifelse(plate_z >= (sz_bot - 1.45/12) &
plate_z <= (sz_top + 1.45/12) &
abs(plate_x) <= (17+1.45)/12/2 ,
"1", "0"))
# Creating distance from center variable
pitchers2 <- pitchers2 %>%
filter(pitch_type != "Pitch Out",
!is.na(pitch_type)) %>%
mutate(
loc_x = abs(plate_x),
loc_y = abs(plate_z - (sz_top + sz_bot) / 2),
dist = sqrt(loc_x^2 + loc_y^2))
# Creating speed change variable
pitchers2 <- pitchers2 %>%
mutate(speed_change = pitch_speed - mean(pitch_speed),
.by = c(pitch_type, game_date, player_id) )
# Creating break change variable
pitchers2 <- pitchers2 %>%
mutate(pfx_total = sqrt(pfx_x^2 + pfx_z^2)) %>%
mutate(break_change = pfx_total - mean(pfx_total),
.by = c(pitch_type, game_date, player_id) )
pitchers2 %>% group_by(zone) %>% summarize(n())
# Distance from Center
avg_dist <- pitchers2$zone  %in% "1" %>%
mean()
# Distance from Center
avg_dist <- pitchers2$zone %>%
mean()
# Distance from Center
avg_dist <- pitchers2$zone  %in% "1" %>%
mean()
# Distance from Center
avg_dist <- pitchers2 %>%
filter(zone == 1) %>%
summarize(mean(dist))
# Distance from Center
avg_dist <- pitchers2 %>%
filter(zone == 1) %>%
summarize(mean(dist))[1,1]
View(avg_dist)
avg_dist <- avg_dist[1,1]
View(avg_dist)
avg_dist <- avg_dist$`mean(dist)`[1]
# Distance from Center
avg_dist <- pitchers2 %>%
filter(zone == 1) %>%
summarize(mean(dist))$`mean(dist)`[1]
pitchers2 %>%
ggplot(aes(x = dist)) +
geom_histogram(color = "white", binwidth = 0.1)+
geom_vline(xintercept = avg_dist, color = "green")
# Model?
model <- lm(run_exp_added ~ dist + speed_change + break_change,
data = pitchers2)
model
model %>% summary
cor(pitchers2$dist, pitchers2$run_exp_added)
pitchers2 %>%
filter(!is.na(dist)) %>%
with(cor(dist, run_exp_added))
pitchers2 %>%
filter(!is.na(run_exp_added)) %>%
with(cor(dist, run_exp_added))
pitchers2 %>%
filter(!is.na(run_exp_added)) %>%
with(cor(speed_change, run_exp_added))
pitchers2 %>%
filter(!is.na(run_exp_added)) %>%
with(cor(break_change, run_exp_added))
pitchers2 %>%
filter(!is.na(run_exp_added), !is.na(break_change)) %>%
with(cor(break_change, run_exp_added))
preds <- pitchers2 %>%
mutate(preds = predict(model, pitchers2))
preds <- pitchers2 %>%
mutate(predicted = predict(model, pitchers2)) %>%
rename(observed = run_exp_added) %>%
select(ID, zone, pitch_type, observed, predicted)
View(preds)
preds %>%
ggplot(aes(x = observed, y = predicted)) +
geom_point() +
geom_smooth()
preds %>%
ggplot(aes(x = observed, y = predicted)) +
geom_point() +
geom_smooth() +
facet_wrap(~ pitch_type)
preds %>%
ggplot(aes(x = observed, y = predicted)) +
geom_point(alpha = 0.5) +
geom_smooth() +
facet_wrap(~ pitch_type)
preds <- pitchers2 %>%
filter(pitch_type != "PO") %>%
mutate(predicted = predict(model, pitchers2)) %>%
rename(observed = run_exp_added) %>%
select(ID, zone, pitch_type, observed, predicted)
preds %>%
ggplot(aes(x = observed, y = predicted)) +
geom_point() +
geom_smooth()
preds <- pitchers2 %>%
filter(pitch_type != "PO") %>%
mutate(predicted = predict(model, pitchers2)) %>%
rename(observed = run_exp_added) %>%
select(ID, zone, pitch_type, observed, predicted)
preds <- pitchers2 %>%
mutate(predicted = predict(model, pitchers2)) %>%
rename(observed = run_exp_added) %>%
select(ID, zone, pitch_type, observed, predicted) %>%
filter(pitch_type != "PO")
preds %>%
ggplot(aes(x = observed, y = predicted)) +
geom_point() +
geom_smooth()
preds %>%
ggplot(aes(x = observed, y = predicted)) +
geom_point() +
geom_smooth()
preds %>%
ggplot(aes(x = observed, y = predicted)) +
geom_point(alpha = 0.5) +
geom_smooth() +
facet_wrap(~ pitch_type)
preds %>%
ggplot(aes(x = observed, y = predicted)) +
geom_point(alpha = 0.5) +
geom_smooth()
acc <- preds %>%
ggplot(aes(x = observed, y = predicted)) +
geom_point(alpha = 0.5) +
geom_smooth()
ac
acc
acc +
facet_wrap(~ pitch_type)
acc +
facet_wrap(~ ID)
