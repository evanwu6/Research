# Refined Model
sl_r_whiff <- glm(whiff ~ pitch_speed + pfx_x + pfx_z + pfx_total + zone + dist_x + dist_z +
dist_prop + I(dist_x^2) + I(dist_z^2) + release_spin_rate + pred_bwhiff,
data = sl_r, family = binomial)
# Model Evaluation
summary(sl_r_whiff)
# Refined Model
sl_r_whiff <- glm(whiff ~ pfx_x + pfx_z + pfx_total + zone + dist_x + dist_z +
dist_prop + I(dist_x^2) + I(dist_z^2) + release_spin_rate + pred_bwhiff,
data = sl_r, family = binomial)
# Model Evaluation
summary(sl_r_whiff)
sl_r_whiff_test <- augment(sl_r_whiff)
rmse(sl_r_whiff_test$prediction, sl_r_whiff_test$whiff)
rmse(sl_r_whiff_test$prediction, sl_r_whiff_test$whiff)
sl_r_whiff_test <- sl_r_whiff_test %>%
mutate(prediction_log = predict(sl_r_whiff, sl_r_whiff_test),
prediction = 1 / (1 + exp(-prediction_log)),
rounded_pred = case_when(
prediction >= 0.5 ~ 1,
prediction < 0.5 ~ 0
)) %>%
filter(!is.na(prediction)) %>%
mutate(Response = "whiff",
Hand = "right",
pitch = "slider")
rmse(sl_r_whiff_test$prediction, sl_r_whiff_test$whiff)
# Refined Model
sl_r_barrel <- glm(Barrel ~ pitch_speed + pfx_x + pfx_z + pfx_total + zone + dist_x + dist_z +
dist_prop + I(dist_x^2) + I(dist_z^2) + release_spin_rate + pred_bbarrel,
data = sl_r, family = binomial)
# Model Evaluation
summary(sl_r_barrel)
sl_r_barrel_test <- augment(sl_r_barrel)
sl_r_barrel_test <- sl_r_barrel_test %>%
mutate(prediction_log = predict(sl_r_barrel, sl_r_barrel_test),
prediction = 1 / (1 + exp(-prediction_log)),
rounded_pred = case_when(
prediction >= 0.5 ~ 1,
prediction < 0.5 ~ 0
)) %>%
filter(!is.na(prediction)) %>%
mutate(Response = "barrel",
Hand = "right",
pitch = "slider")
rmse(sl_r_barrel_test$prediction, sl_r_barrel_test$Barrel)
# Model Evaluation
summary(sl_r_barrel)
# Refined Model
sl_r_barrel <- glm(Barrel ~ pitch_speed + pfx_x + pfx_z + pfx_total + zone + dist_x + dist_z +
dist_prop + I(dist_x^2) + I(dist_z^2) + pred_bbarrel,
data = sl_r, family = binomial)
# Refined Model
sl_r_barrel <- glm(Barrel ~ pitch_speed + pfx_x + pfx_z + pfx_total + zone + dist_x + dist_z +
dist_prop + I(dist_x^2) + I(dist_z^2) + pred_bbarrel,
data = sl_r, family = binomial)
# Model Evaluation
summary(sl_r_barrel)
# Refined Model
sl_r_barrel <- glm(Barrel ~ pitch_speed + pfx_x + pfx_z + zone + dist_x + dist_z +
dist_prop + I(dist_x^2) + I(dist_z^2) + pred_bbarrel,
data = sl_r, family = binomial)
# Refined Model
sl_r_barrel <- glm(Barrel ~ pitch_speed + pfx_x + pfx_z + zone + dist_x + dist_z +
dist_prop + I(dist_x^2) + I(dist_z^2) + pred_bbarrel,
data = sl_r, family = binomial)
# Model Evaluation
summary(sl_r_barrel)
# Refined Model
sl_r_barrel <- glm(Barrel ~ pitch_speed + pfx_x + pfx_z + zone + dist_x + dist_z +
dist_prop + I(dist_x^2) + I(dist_z^2) + pred_bbarrel,
data = sl_r, family = binomial)
# Model Evaluation
summary(sl_r_barrel)
sl_r_barrel_test <- augment(sl_r_barrel)
sl_r_barrel_test <- sl_r_barrel_test %>%
mutate(prediction_log = predict(sl_r_barrel, sl_r_barrel_test),
prediction = 1 / (1 + exp(-prediction_log)),
rounded_pred = case_when(
prediction >= 0.5 ~ 1,
prediction < 0.5 ~ 0
)) %>%
filter(!is.na(prediction)) %>%
mutate(Response = "barrel",
Hand = "right",
pitch = "slider")
rmse(sl_r_barrel_test$prediction, sl_r_barrel_test$Barrel)
# Model Evaluation
summary(sl_r_barrel)
# Refined Model
sl_r_barrel <- glm(Barrel ~ pitch_speed + pfx_x + pfx_z + zone + dist_x + dist_z +
I(dist_x^2) + I(dist_z^2) + pred_bbarrel,
data = sl_r, family = binomial)
# Refined Model
sl_r_barrel <- glm(Barrel ~ pitch_speed + pfx_x + pfx_z + zone + dist_x + dist_z +
I(dist_x^2) + I(dist_z^2) + pred_bbarrel,
data = sl_r, family = binomial)
# Model Evaluation
summary(sl_r_barrel)
# Refined Model
sl_r_barrel <- glm(Barrel ~ pitch_speed + pfx_x + pfx_z + dist_x + dist_z +
I(dist_x^2) + I(dist_z^2) + pred_bbarrel,
data = sl_r, family = binomial)
# Refined Model
sl_r_barrel <- glm(Barrel ~ pitch_speed + pfx_x + pfx_z + dist_x + dist_z +
I(dist_x^2) + I(dist_z^2) + pred_bbarrel,
data = sl_r, family = binomial)
# Model Evaluation
summary(sl_r_barrel)
# Refined Model
sl_r_barrel <- glm(Barrel ~ pitch_speed + pfx_z + dist_x + dist_z +
I(dist_x^2) + I(dist_z^2) + pred_bbarrel,
data = sl_r, family = binomial)
# Model Evaluation
summary(sl_r_barrel)
# Refined Model
sl_r_barrel <- glm(Barrel ~ pitch_speed + dist_x + dist_z +
I(dist_x^2) + I(dist_z^2) + pred_bbarrel,
data = sl_r, family = binomial)
# Model Evaluation
summary(sl_r_barrel)
# Refined Model
sl_r_barrel <- glm(Barrel ~ dist_x + dist_z +
I(dist_x^2) + I(dist_z^2) + pred_bbarrel,
data = sl_r, family = binomial)
# Model Evaluation
summary(sl_r_barrel)
sl_r_barrel_test <- augment(sl_r_barrel)
sl_r_barrel_test <- sl_r_barrel_test %>%
mutate(prediction_log = predict(sl_r_barrel, sl_r_barrel_test),
prediction = 1 / (1 + exp(-prediction_log)),
rounded_pred = case_when(
prediction >= 0.5 ~ 1,
prediction < 0.5 ~ 0
)) %>%
filter(!is.na(prediction)) %>%
mutate(Response = "barrel",
Hand = "right",
pitch = "slider")
rmse(sl_r_barrel_test$prediction, sl_r_barrel_test$Barrel)
# Refined Model
sl_r_strike <- glm(STRIKE ~ pitch_speed + pfx_x + pfx_z + pfx_total + zone + dist_x + dist_z +
dist_prop + I(dist_x^2) + I(dist_z^2) + release_spin_rate + pred_bstrike,
data = sl_r, family = binomial)
# Model Evaluation
summary(sl_r_strike)
sl_r_strike_test <- augment(sl_r_strike)
sl_r_strike_test <- sl_r_strike_test %>%
mutate(prediction_log = predict(sl_r_strike, sl_r_strike_test),
prediction = 1 / (1 + exp(-prediction_log)),
rounded_pred = case_when(
prediction >= 0.5 ~ 1,
prediction < 0.5 ~ 0
)) %>%
filter(!is.na(prediction)) %>%
mutate(Response = "strike",
Hand = "right",
pitch = "slider")
rmse(sl_r_strike_test$prediction, sl_r_strike_test$STRIKE)
# Refined Model
sl_r_strike <- glm(STRIKE ~ pitch_speed + pfx_x + pfx_z + pfx_total + zone + dist_x + dist_z +
dist_prop + I(dist_x^2) + I(dist_z^2) + release_spin_rate + pred_bstrike,
data = sl_r, family = binomial)
# Refined Model
sl_r_strike <- glm(STRIKE ~ pitch_speed + pfx_x + pfx_z + pfx_total + zone + dist_x + dist_z +
dist_prop + I(dist_x^2) + I(dist_z^2) + release_spin_rate + pred_bstrike,
data = sl_r, family = binomial)
# Model Evaluation
summary(sl_r_strike)
sl_l <- rhp %>%
filter(pitch_type == "SL",
hitter == "L") %>%
mutate(Barrel = ifelse(Barrel == TRUE, 1, 0),
whiff = ifelse(whiff == TRUE, 1, 0))
# Refined Model
sl_l_whiff <- glm(whiff ~ pitch_speed + pfx_x + pfx_z + pfx_total + zone + dist_x + dist_z +
dist_prop + I(dist_x^2) + I(dist_z^2) + release_spin_rate + pred_bwhiff,
data = sl_l, family = binomial)
# Model Evaluation
summary(sl_l_whiff)
sl_l_whiff_test <- augment(sl_l_whiff)
sl_l_whiff_test <- sl_l_whiff_test %>%
mutate(prediction_log = predict(sl_l_whiff, sl_l_whiff_test),
prediction = 1 / (1 + exp(-prediction_log)),
rounded_pred = case_when(
prediction >= 0.5 ~ 1,
prediction < 0.5 ~ 0
)) %>%
filter(!is.na(prediction)) %>%
mutate(Response = "whiff",
Hand = "left",
pitch = "slider")
rmse(sl_l_whiff_test$prediction, sl_l_whiff_test$whiff)
# Model Evaluation
summary(sl_l_whiff)
# Refined Model
sl_l_whiff <- glm(whiff ~ pitch_speed + pfx_x + pfx_total + zone + dist_x + dist_z +
dist_prop + I(dist_x^2) + I(dist_z^2) + release_spin_rate + pred_bwhiff,
data = sl_l, family = binomial)
# Model Evaluation
summary(sl_l_whiff)
# Refined Model
sl_l_whiff <- glm(whiff ~ pitch_speed + pfx_total + zone + dist_x + dist_z +
dist_prop + I(dist_x^2) + I(dist_z^2) + release_spin_rate + pred_bwhiff,
data = sl_l, family = binomial)
# Model Evaluation
summary(sl_l_whiff)
# Refined Model
sl_l_whiff <- glm(whiff ~ pitch_speed + zone + dist_x + dist_z +
dist_prop + I(dist_x^2) + I(dist_z^2) + release_spin_rate + pred_bwhiff,
data = sl_l, family = binomial)
# Model Evaluation
summary(sl_l_whiff)
sl_l_whiff_test <- augment(sl_l_whiff)
sl_l_whiff_test <- sl_l_whiff_test %>%
mutate(prediction_log = predict(sl_l_whiff, sl_l_whiff_test),
prediction = 1 / (1 + exp(-prediction_log)),
rounded_pred = case_when(
prediction >= 0.5 ~ 1,
prediction < 0.5 ~ 0
)) %>%
filter(!is.na(prediction)) %>%
mutate(Response = "whiff",
Hand = "left",
pitch = "slider")
rmse(sl_l_whiff_test$prediction, sl_l_whiff_test$whiff)
# Refined Model
sl_l_barrel <- glm(Barrel ~ pitch_speed + pfx_x + pfx_z + pfx_total + zone + dist_x + dist_z +
dist_prop + I(dist_x^2) + I(dist_z^2) + release_spin_rate + pred_bbarrel,
data = sl_l, family = binomial)
# Model Evaluation
summary(sl_l_barrel)
sl_l_barrel_test <- augment(sl_l_barrel)
sl_l_barrel_test <- sl_l_barrel_test %>%
mutate(prediction_log = predict(sl_l_barrel, sl_l_barrel_test),
prediction = 1 / (1 + exp(-prediction_log)),
rounded_pred = case_when(
prediction >= 0.5 ~ 1,
prediction < 0.5 ~ 0
)) %>%
filter(!is.na(prediction)) %>%
mutate(Response = "barrel",
Hand = "left",
pitch = "slider")
rmse(sl_l_barrel_test$prediction, sl_l_barrel_test$Barrel)
# Model Evaluation
summary(sl_l_barrel)
# Refined Model
sl_l_barrel <- glm(Barrel ~ pitch_speed + pfx_x + pfx_z + zone + dist_x + dist_z +
dist_prop + I(dist_x^2) + I(dist_z^2) + release_spin_rate + pred_bbarrel,
data = sl_l, family = binomial)
# Model Evaluation
summary(sl_l_barrel)
# Refined Model
sl_l_barrel <- glm(Barrel ~ pitch_speed + pfx_x + pfx_z + zone + dist_x + dist_z +
dist_prop + I(dist_x^2) + I(dist_z^2) + release_spin_rate + pred_bbarrel,
data = sl_l, family = binomial)
# Model Evaluation
summary(sl_l_barrel)
# Refined Model
sl_l_barrel <- glm(Barrel ~ pitch_speed + pfx_x + pfx_z + zone + dist_x + dist_z +
I(dist_x^2) + I(dist_z^2) + release_spin_rate + pred_bbarrel,
data = sl_l, family = binomial)
# Model Evaluation
summary(sl_l_barrel)
# Refined Model
sl_l_barrel <- glm(Barrel ~ pitch_speed + pfx_x + pfx_z + zone + dist_x + dist_z +
I(dist_x^2) + I(dist_z^2) + pred_bbarrel,
data = sl_l, family = binomial)
# Model Evaluation
summary(sl_l_barrel)
sl_l_barrel_test <- augment(sl_l_barrel)
sl_l_barrel_test <- sl_l_barrel_test %>%
mutate(prediction_log = predict(sl_l_barrel, sl_l_barrel_test),
prediction = 1 / (1 + exp(-prediction_log)),
rounded_pred = case_when(
prediction >= 0.5 ~ 1,
prediction < 0.5 ~ 0
)) %>%
filter(!is.na(prediction)) %>%
mutate(Response = "barrel",
Hand = "left",
pitch = "slider")
rmse(sl_l_barrel_test$prediction, sl_l_barrel_test$Barrel)
# Refined Model
sl_l_strike <- glm(STRIKE ~ pitch_speed + pfx_x + pfx_z + pfx_total + zone + dist_x + dist_z +
dist_prop + I(dist_x^2) + I(dist_z^2) + release_spin_rate + pred_bstrike,
data = sl_l, family = binomial)
# Refined Model
sl_l_strike <- glm(STRIKE ~ pitch_speed + pfx_x + pfx_z + pfx_total + zone + dist_x + dist_z +
dist_prop + I(dist_x^2) + I(dist_z^2) + release_spin_rate + pred_bstrike,
data = sl_l, family = binomial)
# Model Evaluation
summary(sl_l_strike)
# Model Evaluation
summary(sl_l_strike)
sl_l_strike_test <- augment(sl_l_strike)
sl_l_strike_test <- sl_l_strike_test %>%
mutate(prediction_log = predict(sl_l_strike, sl_l_strike_test),
prediction = 1 / (1 + exp(-prediction_log)),
rounded_pred = case_when(
prediction >= 0.5 ~ 1,
prediction < 0.5 ~ 0
)) %>%
filter(!is.na(prediction)) %>%
mutate(Response = "strike",
Hand = "left",
pitch = "slider")
rmse(sl_l_strike_test$prediction, sl_l_strike_test$STRIKE)
0.431122
# Model Evaluation
summary(sl_l_strike)
# Refined Model
sl_l_strike <- glm(STRIKE ~ pitch_speed + pfx_x + pfx_total + zone + dist_x + dist_z +
dist_prop + I(dist_x^2) + I(dist_z^2) + release_spin_rate + pred_bstrike,
data = sl_l, family = binomial)
# Model Evaluation
summary(sl_l_strike)
# Refined Model
sl_l_strike <- glm(STRIKE ~ pitch_speed + pfx_x + pfx_total + zone + dist_x + dist_z +
dist_prop + I(dist_x^2) + I(dist_z^2) + pred_bstrike,
data = sl_l, family = binomial)
# Model Evaluation
summary(sl_l_strike)
sl_l_strike_test <- augment(sl_l_strike)
# Refined Model
sl_l_strike <- glm(STRIKE ~ pfx_x + pfx_total + zone + dist_x + dist_z +
dist_prop + I(dist_x^2) + I(dist_z^2) + pred_bstrike,
data = sl_l, family = binomial)
# Model Evaluation
summary(sl_l_strike)
sl_l_strike_test <- augment(sl_l_strike)
sl_l_strike_test <- sl_l_strike_test %>%
mutate(prediction_log = predict(sl_l_strike, sl_l_strike_test),
prediction = 1 / (1 + exp(-prediction_log)),
rounded_pred = case_when(
prediction >= 0.5 ~ 1,
prediction < 0.5 ~ 0
)) %>%
filter(!is.na(prediction)) %>%
mutate(Response = "strike",
Hand = "left",
pitch = "slider")
rmse(sl_l_strike_test$prediction, sl_l_strike_test$STRIKE)
augment(sl_l_strike) %>%  View
broom(sl_l_strike) %>% View
library(broom)
broom(sl_l_strike) %>% View
tidy(sl_l_strike) %>% View
tidy(sl_l_strike)
models <- rbind(
tidy(fb_r_whiff) %>% mutate(Response = "whiff",
Hand = "left", Pitch = "fastball"),
tidy(fb_r_barrel) %>% mutate(Response = "barrel",
Hand = "left", Pitch = "fastball"),
tidy(fb_r_strike) %>% mutate(Response = "strike",
Hand = "left", Pitch = "fastball"),
tidy(fb_l_whiff) %>% mutate(Response = "whiff",
Hand = "left", Pitch = "fastball"),
tidy(fb_l_barrel) %>% mutate(Response = "barrel",
Hand = "left", Pitch = "fastball"),
tidy(fb_l_strike) %>% mutate(Response = "strike",
Hand = "left", Pitch = "fastball"),
tidy(sl_r_whiff) %>% mutate(Response = "whiff",
Hand = "right", Pitch = "slider"),
tidy(sl_r_barrel) %>% mutate(Response = "barrel",
Hand = "right", Pitch = "slider"),
tidy(sl_r_strike) %>% mutate(Response = "strike",
Hand = "right", Pitch = "slider"),
tidy(sl_l_whiff) %>% mutate(Response = "whiff",
Hand = "left", Pitch = "slider"),
tidy(sl_l_barrel) %>% mutate(Response = "barrel",
Hand = "left", Pitch = "slider"),
tidy(sl_l_strike) %>% mutate(Response = "strike",
Hand = "left", Pitch = "slider"))
View(models)
write.csv(models, "models2.csv")
View(batter_stats)
batter_preds <- rbind(batter_stats,
batter_stats2,
batter_stats3)
batter_preds <- combine_rows(batter_stats,
batter_stats2,
batter_stats3)
View(batter_stats)
View(batter_stats)
batter_preds <- batter_stats %>%
left_join(batters_stats2, by = c("batter", "pitch_type")) %>%
left_join(batters_stats3, by = c("batter", "pitch_type"))
batter_preds <- batter_stats %>%
left_join(batter_stats2, by = c("batter", "pitch_type")) %>%
left_join(batter_stats3, by = c("batter", "pitch_type"))
View(batter_preds)
batter_preds <- batter_stats %>%
left_join(batter_stats2, by = c("batter", "pitch_type")) %>%
left_join(batter_stats3, by = c("batter", "pitch_type")) %>%
rename(pitches = pitches.x) %>%
select(batter, pitch_type, pitches, pred_bwhiff, pred_bbarrel, pred_bstrike)
batter_preds <- batter_stats %>%
left_join(batter_stats2, by = c("batter", "pitch_type")) %>%
left_join(batter_stats3, by = c("batter", "pitch_type")) %>%
select(batter, pitch_type, pitches, pred_bwhiff, pred_bbarrel, pred_bstrike)
View(batter_preds)
View(batter_stats_l)
batter_preds_r <- batter_stats %>%
left_join(batter_stats2, by = c("batter", "pitch_type")) %>%
left_join(batter_stats3, by = c("batter", "pitch_type")) %>%
select(batter, pitch_type, pitches, pred_bwhiff, pred_bbarrel, pred_bstrike) %>%
mutate(hitter = "L")
batter_preds_r <- batter_stats %>%
left_join(batter_stats2, by = c("batter", "pitch_type")) %>%
left_join(batter_stats3, by = c("batter", "pitch_type")) %>%
select(batter, pitch_type, pitches, pred_bwhiff, pred_bbarrel, pred_bstrike) %>%
mutate(hitter = "R")
batter_preds_l <- batter_stats_l %>%
left_join(batter_stats2_l, by = c("batter", "pitch_type")) %>%
left_join(batter_stats3_l, by = c("batter", "pitch_type")) %>%
select(batter, pitch_type, pitches, pred_bwhiff, pred_bbarrel, pred_bstrike) %>%
mutate(hitter = "L")
pred_means <- rbind(batter_preds_r, batter_preds_l) %>%
group_by(hitter, pitch_type) %>%
summarize(whiff_mean = weighted.mean(pred_bwhiff, pitches, na.rm = TRUE),
barrel_mean = weighted.mean(pred_bbarrel, pitches, na.rm = TRUE),
strike_mean = weighted.mean(pred_bstrike, pitches, na.rm = TRUE))
View(pred_means)
write.csv(pred_means, "pred means.csv")
shiny::runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
setwd("~/Downloads/Research/Research")
# Data ####
movement <- read_csv("Movement.csv") %>%
mutate(min_x = min_x*12,
max_x = max_x*12,
min_z = min_z*12,
max_z = max_z*12) %>%
filter(min_spin != "Inf",
!is.na(pitch_speed))
comp_data <- read_csv("Pitcher_Comps.csv") %>%
select(-...1) %>%
mutate(`X Movement` = round(`X Movement`*12, 2),
`Z Movement` = round(`Z Movement`*12, 2),
`Spin Rate` = round(`Spin Rate`, 0),
Speed = round(Speed, 1))
library(tidyverse)
library(shiny)
library(shinyjs)
library(scales)
library(knitr)
# Data ####
movement <- read_csv("Movement.csv") %>%
mutate(min_x = min_x*12,
max_x = max_x*12,
min_z = min_z*12,
max_z = max_z*12) %>%
filter(min_spin != "Inf",
!is.na(pitch_speed))
comp_data <- read_csv("Pitcher_Comps.csv") %>%
select(-...1) %>%
mutate(`X Movement` = round(`X Movement`*12, 2),
`Z Movement` = round(`Z Movement`*12, 2),
`Spin Rate` = round(`Spin Rate`, 0),
Speed = round(Speed, 1))
comp_mean <- comp_data %>%
group_by(p_throws, pitch_type) %>%
summarize(mean_speed = weighted.mean(Speed, Pitches, na.rm = TRUE),
mean_spin = weighted.mean(`Spin Rate`, Pitches, na.rm = TRUE),
mean_move_x = weighted.mean(`X Movement`, Pitches, na.rm = TRUE),
mean_move_z = weighted.mean(`Z Movement`, Pitches, na.rm = TRUE),
std_speed = sd(Speed),
std_spin = sd(`Spin Rate`),
std_move_x = sd(`X Movement`),
std_move_z = sd(`Z Movement`))
model <- read_csv("models2.csv") %>%
select(-...1)
pred_means <- read_csv("pred means.csv") %>%
select(-...1)
View(pred_means)
View(pred_means)
View(model)
View(model)
(2127 + 138)
sqrt(16+9)
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
t <- data.frame(1421, 241412, 421421)
View(t)
runApp()
runApp()
View(model)
runApp()
